
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Riceflow - Panolyzer Rice Quality Analyzer</title>
    <meta name="description" content="AI Deep Learning Vision: The Panolyzer utilizes advanced AI deep learning vision technology to accurately analyze and classify rice grains. Our system can detect multiple quality parameters with exceptional precision." />
    <meta name="author" content="Lovable" />

    <!-- PWA Meta Tags -->
    <link rel="manifest" href="/manifest.webmanifest" />
    <meta name="theme-color" content="#059669" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Riceflow" />
    <link rel="apple-touch-icon" href="/lovable-uploads/649554cd-4d80-484a-995d-e49f2721a07d.png" />
    <link rel="mask-icon" href="/lovable-uploads/649554cd-4d80-484a-995d-e49f2721a07d.png" color="#059669" />
    <meta name="msapplication-TileColor" content="#059669" />
    <meta name="msapplication-TileImage" content="/lovable-uploads/649554cd-4d80-484a-995d-e49f2721a07d.png" />

    <link rel="icon" href="/lovable-uploads/649554cd-4d80-484a-995d-e49f2721a07d.png" type="image/png" />

    <meta property="og:title" content="Riceflow - Panolyzer Rice Quality Analyzer" />
    <meta property="og:description" content="AI Deep Learning Vision: The Panolyzer utilizes advanced AI deep learning vision technology to accurately analyze and classify rice grains. Our system can detect multiple quality parameters with exceptional precision." />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="/lovable-uploads/49e4e3a9-d748-4edf-bd4f-726dd0b9fde9.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@lovable_dev" />
    <meta name="twitter:image" content="/lovable-uploads/49e4e3a9-d748-4edf-bd4f-726dd0b9fde9.png" />

    <!-- CRITICAL: iOS PWA Service Worker Fix - MUST BE FIRST SCRIPT -->
    <script>
      console.log('üö® EMERGENCY iOS PWA Service Worker Disable - Running in HEAD');
      
      if ('serviceWorker' in navigator) {
        // Block service worker registration immediately
        const originalRegister = navigator.serviceWorker.register;
        navigator.serviceWorker.register = function(...args) {
          console.error('üö´ BLOCKED Service Worker registration in HEAD:', args[0]);
          return Promise.reject(new Error('Service Worker blocked for iOS PWA'));
        };

        // Aggressively unregister all service workers
        navigator.serviceWorker.getRegistrations().then((registrations) => {
          registrations.forEach((registration) => {
            console.log('üóëÔ∏è HEAD: Force unregistering service worker:', registration.scope);
            registration.unregister().then((success) => {
              console.log('üóëÔ∏è HEAD: Service worker unregistration result:', success);
            });
          });
        });

        // Try to block ready promise (with error handling)
        try {
          const descriptor = Object.getOwnPropertyDescriptor(navigator.serviceWorker, 'ready');
          if (descriptor && descriptor.configurable) {
            Object.defineProperty(navigator.serviceWorker, 'ready', {
              get() {
                console.error('üö´ Service Worker ready blocked in HEAD');
                return Promise.reject(new Error('Service Worker disabled for iOS PWA'));
              },
              configurable: true
            });
            console.log('‚úÖ HEAD: Service Worker ready property overridden');
          } else {
            console.warn('‚ö†Ô∏è HEAD: Service Worker ready property not configurable');
          }
        } catch (e) {
          console.warn('‚ö†Ô∏è HEAD: Could not override ready property:', e.message);
        }
      }

      // Block WebSocket immediately but don't crash
      if (typeof WebSocket !== 'undefined') {
        const OriginalWebSocket = WebSocket;
        window.WebSocket = function BlockedWebSocket(url, protocols) {
          console.error('üö´ HEAD: WebSocket blocked:', url);
          
          // Return mock instead of throwing
          const mockSocket = {
            readyState: 3, // CLOSED
            close: function() {},
            send: function() {},
            addEventListener: function() {},
            removeEventListener: function() {},
            dispatchEvent: function() { return false; },
            onopen: null,
            onclose: null,
            onmessage: null,
            onerror: null,
            url: url.toString(),
            protocol: '',
            extensions: '',
            bufferedAmount: 0,
            binaryType: 'blob',
            CONNECTING: 0,
            OPEN: 1,
            CLOSING: 2,
            CLOSED: 3
          };

          // Simulate immediate close
          setTimeout(function() {
            if (mockSocket.onclose) {
              mockSocket.onclose({ code: 1006, reason: 'WebSocket blocked for iOS PWA' });
            }
          }, 0);

          return mockSocket;
        };
      }

      console.log('‚úÖ HEAD: iOS PWA emergency fixes applied');
    </script>
  </head>

  <body>
    <div id="root"></div>
    <!-- IMPORTANT: DO NOT REMOVE THIS SCRIPT TAG OR THIS VERY COMMENT! -->
    <script src="https://cdn.gpteng.co/gptengineer.js" type="module"></script>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
